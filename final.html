<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Sosyal Medya TasarÄ±mcÄ±sÄ± Pro - Advanced Professional Edition</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #28a745;
            --danger: #dc3545;
            --dark: #1a1a2e;
            --light: #f8f9fa;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            padding: 15px;
        }

        .container {
            max-width: 1900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.4);
            overflow: hidden;
            backdrop-filter: blur(10px);
        }

        header {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        header h1 {
            font-size: 2.5em;
            margin-bottom: 5px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
        }

        header p {
            font-size: 1em;
            opacity: 0.95;
        }

        .main-content {
            display: grid;
            grid-template-columns: 400px 1fr;
            gap: 20px;
            padding: 25px;
            min-height: calc(100vh - 200px);
        }

        .sidebar {
            background: linear-gradient(135deg, var(--light) 0%, #e9ecef 100%);
            padding: 20px;
            border-radius: 15px;
            max-height: calc(100vh - 250px);
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
        }

        .sidebar::-webkit-scrollbar {
            width: 8px;
        }

        .sidebar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }

        .sidebar::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 10px;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            color: var(--primary);
            margin-bottom: 12px;
            font-size: 1.1em;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid var(--primary);
        }

        .upload-area {
            border: 3px dashed var(--primary);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: white;
        }

        .upload-area:hover {
            background: #f0f4ff;
            border-color: var(--secondary);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }

        .upload-area.dragover {
            background: #e8f0ff;
            border-color: var(--secondary);
            transform: scale(1.02);
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            transition: all 0.3s ease;
            font-weight: 600;
            width: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            margin-top: 10px;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40, 167, 69, 0.4);
        }

        input[type="file"] {
            display: none;
        }

        input[type="text"],
        input[type="range"],
        select,
        textarea {
            width: 100%;
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            font-size: 0.95em;
            margin-bottom: 10px;
            transition: border-color 0.3s ease;
        }

        textarea {
            resize: vertical;
            min-height: 70px;
            font-family: inherit;
        }

        input[type="color"] {
            width: 100%;
            height: 45px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            cursor: pointer;
        }

        .slider-container {
            margin-bottom: 15px;
        }

        .slider-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 0.9em;
            color: #495057;
            font-weight: 600;
        }

        .btn-toggle {
            padding: 10px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
            font-weight: 600;
        }

        .btn-toggle:hover {
            border-color: var(--primary);
            background: #f0f4ff;
        }

        .btn-toggle.active {
            border-color: var(--primary);
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
        }

        .preset-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 8px;
        }

        .preset-item {
            height: 45px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 3px solid transparent;
        }

        .preset-item:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .preset-item.active {
            border-color: white;
            box-shadow: 0 0 0 2px var(--primary);
        }

        .canvas-container {
            background: linear-gradient(135deg, var(--light) 0%, #e9ecef 100%);
            border-radius: 15px;
            padding: 30px;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 600px;
            position: relative;
        }

        #canvas {
            max-width: 100%;
            max-height: 700px;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            background: white;
        }

        .format-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 8px;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            border-radius: 10px;
            box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
            display: none;
            animation: slideIn 0.4s ease;
            z-index: 1000;
            font-weight: 600;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 650px;
            width: 90%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 25px 80px rgba(0, 0, 0, 0.5);
        }

        .modal-content h2 {
            color: var(--primary);
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-close {
            float: right;
            font-size: 1.5em;
            cursor: pointer;
            color: #6c757d;
        }

        .modal-close:hover {
            color: var(--danger);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            border-bottom: 2px solid #dee2e6;
            overflow-x: auto;
        }

        .tab-btn {
            padding: 10px 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        .tab-btn:hover {
            color: var(--primary);
        }

        .tab-btn.active {
            color: var(--primary);
            border-bottom-color: var(--primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .ai-suggestion {
            padding: 12px;
            background: linear-gradient(135deg, #f0f4ff 0%, #e8f0ff 100%);
            border-left: 4px solid var(--primary);
            border-radius: 6px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .ai-suggestion:hover {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-left-color: white;
            transform: translateX(5px);
        }

        .layer-item, .logo-item {
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .layer-item:hover, .logo-item:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            background: #f9fafb;
        }

        .layer-item.active, .logo-item.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .layer-item strong, .logo-item strong, .text-item strong {
            display: block;
            font-size: 0.95em;
        }

        .layer-item small, .logo-item small, .text-item small {
            display: block;
            font-size: 0.85em;
            opacity: 0.8;
            margin-top: 3px;
        }

        .text-item {
            padding: 12px;
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .text-item:hover {
            border-color: var(--primary);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
            background: #f9fafb;
        }

        .text-item.active {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border-color: var(--primary);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .layer-item::after {
            content: 'ğŸ“‚ TÄ±kla GÃ¶rsel Ekle';
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 0.75em;
            color: var(--primary);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .layer-item:hover::after {
            opacity: 1;
        }

        .layer-item.active::after {
            color: white;
        }

        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }

        .drag-overlay {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(102, 126, 234, 0.2);
            border: 3px dashed var(--primary);
            border-radius: 12px;
            align-items: center;
            justify-content: center;
            z-index: 100;
            color: var(--primary);
            font-weight: bold;
            font-size: 1.2em;
        }

        .drag-overlay.active {
            display: flex;
        }

        .upload-wrapper {
            position: relative;
        }

        .layer-status {
            padding: 8px;
            background: #e8f5e9;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 0.85em;
            color: var(--success);
            display: none;
        }

        .layer-status.active {
            display: block;
        }

        .layer-status.error {
            background: #ffebee;
            color: var(--danger);
        }

        @media (max-width: 768px) {
            header h1 {
                font-size: 1.8em;
            }

            .main-content {
                padding: 15px;
                gap: 15px;
            }

            .sidebar {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¨ AI Sosyal Medya TasarÄ±mcÄ±sÄ± Pro - Advanced Edition</h1>
            <p>Profesyonel multi-katman tasarÄ±m | 10 Katman + 20 YazÄ± | 20+ Gradient | 15+ Font | Max AI</p>
            <div style="margin-top: 10px; font-size: 0.85em; opacity: 0.9;">
                âŒ¨ï¸ <strong>KÄ±sayollar:</strong> Del=Sil | Ctrl+C=Klonla | Ctrl+Alt+T=YeniYazÄ± | Ctrl+Alt+C=KlonlaYazÄ± | Ctrl+Z=GeriAl | Ctrl+S=Ä°ndir
            </div>
        </header>

        <div class="main-content">
            <div class="sidebar">
                <!-- KATMANLAR -->
                <div class="section">
                    <h3>ğŸ–¼ï¸ TasarÄ±m KatmanlarÄ± (Max 10)</h3>
                    <div id="layerList" style="max-height: 300px; overflow-y: auto; border-radius: 8px; padding: 5px; background: white;"></div>
                    <button class="btn btn-primary" id="addLayerBtn" style="margin-top: 10px; font-size: 0.9em; padding: 10px;">
                        â• Katman Ekle
                    </button>
                    <button class="btn btn-primary" id="removeLayerBtn" style="margin-top: 8px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); font-size: 0.9em; padding: 10px;">
                        ğŸ—‘ï¸ Sil
                    </button>
                    <button class="btn btn-primary" id="dupLayerBtn" style="margin-top: 8px; background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); font-size: 0.9em; padding: 10px;">
                        ğŸ“‹ Klonla
                    </button>
                    <div style="margin-top: 8px; padding: 8px; background: #e8f5e9; border-radius: 6px; border-left: 3px solid var(--success); font-size: 0.75em; color: #2e7d32;">
                        âŒ¨ï¸ Del: Sil | Ctrl+C: Klonla | Ctrl+â†‘â†“: ÅeffaflÄ±k | +/-: Boyut
                    </div>
                </div>

                <!-- AI YARDIMCI -->
                <div class="section">
                    <h3>ğŸ¤– AI Asistan</h3>
                    <button class="btn btn-primary" id="aiBtn">
                        ğŸ’¡ AkÄ±llÄ± Ã–neriler
                    </button>
                    <button class="btn btn-primary" id="aiAutoBtn" style="margin-top: 10px;">
                        âš¡ Otomatik TasarÄ±m
                    </button>
                </div>

                <!-- ARKA PLAN -->
                <div class="section">
                    <h3>ğŸ¨ Arka Plan & Katmanlar</h3>
                    <div class="preset-grid" id="gradientGrid"></div>
                    <button class="btn btn-primary" id="bgUploadBtn" style="margin-top: 10px; font-size: 0.9em; padding: 10px;">
                        ğŸ“· Arka Plan YÃ¼kle
                    </button>
                    <input type="file" id="bgImageInput" accept="image/*">
                    <div style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 6px; border-left: 3px solid #ffc107; font-size: 0.85em; color: #856404;">
                        ğŸ’¡ Ä°pucu: SÃ¼rÃ¼kle-bÄ±rak ile gÃ¶rseli canvas'a direkt ekleyebilirsin!
                    </div>
                    <div class="slider-container" style="margin-top: 10px;">
                        <div class="slider-label"><span>ÅeffaflÄ±k</span><span id="bgOpacityVal">100%</span></div>
                        <input type="range" id="bgOpacitySlider" min="0" max="100" value="100">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Ã–lÃ§ek</span><span id="bgScaleVal">100%</span></div>
                        <input type="range" id="bgScaleSlider" min="50" max="200" value="100">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>DÃ¶ndÃ¼rme</span><span id="bgRotVal">0Â°</span></div>
                        <input type="range" id="bgRotSlider" min="0" max="360" value="0">
                    </div>
                </div>

                <!-- EFEKTLER -->
                <div class="section">
                    <h3>ğŸ¯ Efektler</h3>
                    <div class="slider-container">
                        <div class="slider-label"><span>BulanÄ±klÄ±k</span><span id="blurVal">0px</span></div>
                        <input type="range" id="blurSlider" min="0" max="30" value="0">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Karartma</span><span id="overlayVal">0%</span></div>
                        <input type="range" id="overlaySlider" min="0" max="80" value="0">
                    </div>
                </div>

                <!-- FORMAT -->
                <div class="section">
                    <h3>ğŸ“± Format</h3>
                    <div class="format-grid">
                        <button class="btn-toggle active" data-fmt="1080x1080">Instagram</button>
                        <button class="btn-toggle" data-fmt="1080x1920">Story</button>
                        <button class="btn-toggle" data-fmt="1200x630">Facebook</button>
                        <button class="btn-toggle" data-fmt="1200x675">Twitter</button>
                        <button class="btn-toggle" data-fmt="1200x627">LinkedIn</button>
                        <button class="btn-toggle" data-fmt="1280x720">YouTube</button>
                    </div>
                </div>

                <!-- FÄ°LTRELER -->
                <div class="section">
                    <h3>âœ¨ Filtreler & Efektler</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 10px;">
                        <button class="btn-toggle active" data-flt="none">Yok</button>
                        <button class="btn-toggle" data-flt="gray">B&B</button>
                        <button class="btn-toggle" data-flt="sepia">Sepia</button>
                        <button class="btn-toggle" data-flt="bright">Parlak</button>
                        <button class="btn-toggle" data-flt="dark">Koyu</button>
                        <button class="btn-toggle" data-flt="vintage">Vintage</button>
                        <button class="btn-toggle" data-flt="cool">SoÄŸuk</button>
                        <button class="btn-toggle" data-flt="warm">SÄ±cak</button>
                        <button class="btn-toggle" data-flt="neon">Neon</button>
                        <button class="btn-toggle" data-flt="invert">Ters</button>
                        <button class="btn-toggle" data-flt="saturate">CanlÄ±</button>
                        <button class="btn-toggle" data-flt="duotone">Duotone</button>
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Saturasyon</span><span id="saturateVal">100%</span></div>
                        <input type="range" id="saturateSlider" min="0" max="200" value="100">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>ParlaklÄ±k</span><span id="brightnessVal">100%</span></div>
                        <input type="range" id="brightnessSlider" min="50" max="150" value="100">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Kontrast</span><span id="contrastVal">100%</span></div>
                        <input type="range" id="contrastSlider" min="50" max="150" value="100">
                    </div>
                    <div class="slider-container">
                        <div class="slider-label"><span>Hue Rotation</span><span id="hueVal">0Â°</span></div>
                        <input type="range" id="hueSlider" min="0" max="360" value="0">
                    </div>
                </div>

                <!-- METIN -->
                <div class="section">
                    <h3>âœï¸ YazÄ±lar (Ã‡oklu)</h3>
                    <div id="textList" style="max-height: 200px; overflow-y: auto; border-radius: 8px; padding: 5px; background: white;"></div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-top: 10px;">
                        <button class="btn btn-primary" id="addTextBtn" style="font-size: 0.9em; padding: 10px;">
                            â• YazÄ± Ekle
                        </button>
                        <button class="btn btn-primary" id="dupTextBtn" style="background: linear-gradient(135deg, #17a2b8 0%, #138496 100%); font-size: 0.9em; padding: 10px;">
                            ğŸ“‹ Klonla
                        </button>
                        <button class="btn btn-primary" id="removeTextBtn" style="background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); font-size: 0.9em; padding: 10px; grid-column: span 2;">
                            ğŸ—‘ï¸ Sil
                        </button>
                    </div>
                    <div style="padding: 8px; background: #fff3cd; border-radius: 6px; border-left: 3px solid #ffc107; font-size: 0.75em; color: #856404; margin-top: 8px;">
                        ğŸ’¡ <strong>KÄ±sayollar:</strong> Ctrl+Alt+T = Yeni YazÄ± | Ctrl+Alt+C = Klonla | Ctrl+Z = Geri Al
                    </div>

                    <div id="textAdvancedControls" style="display:none; margin-top: 12px; padding: 12px; background: #f0f4ff; border-radius: 8px; border-left: 3px solid var(--primary);">
                        <div style="margin-bottom: 12px;">
                            <label style="font-size: 0.85em; color: #495057; font-weight: 600;">YazÄ± Ä°Ã§eriÄŸi</label>
                            <textarea id="textContentInput" style="width: 100%; padding: 8px; border: 2px solid #dee2e6; border-radius: 6px; font-family: inherit; font-size: 0.9em;" rows="3" placeholder="Metni buraya yazÄ±n..."></textarea>
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>Font Boyutu</span><span id="textSizeVal2">48px</span></div>
                            <input type="range" id="textSizeSlider2" min="12" max="200" value="48">
                        </div>

                        <select id="fontSelect2" style="width: 100%; padding: 8px; border: 2px solid #dee2e6; border-radius: 6px; margin-bottom: 10px;">
                            <option value="Arial">Arial</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Impact">Impact</option>
                            <option value="Courier New">Courier New</option>
                            <option value="Verdana">Verdana</option>
                            <option value="Trebuchet MS">Trebuchet MS</option>
                            <option value="Times New Roman">Times New Roman</option>
                            <option value="Comic Sans MS">Comic Sans MS</option>
                            <option value="Palatino">Palatino</option>
                            <option value="Garamond">Garamond</option>
                            <option value="Bookman">Bookman</option>
                            <option value="Consolas">Consolas</option>
                            <option value="Lucida Console">Lucida Console</option>
                            <option value="Segoe UI">Segoe UI</option>
                            <option value="Tahoma">Tahoma</option>
                        </select>

                        <label style="font-size: 0.85em; color: #495057; font-weight: 600; display: block; margin-bottom: 8px;">Renk</label>
                        <input type="color" id="textColorPicker2" style="width: 100%; height: 45px; margin-bottom: 12px;">

                        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 10px;">
                            <button class="btn-toggle" data-align="left" style="font-size: 0.85em;">â† Sol</button>
                            <button class="btn-toggle active" data-align="center" style="font-size: 0.85em;">Orta</button>
                            <button class="btn-toggle" data-align="right" style="font-size: 0.85em;">SaÄŸ â†’</button>
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>X Pozisyonu</span><span id="textXVal2">50%</span></div>
                            <input type="range" id="textXSlider2" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>Y Pozisyonu</span><span id="textYVal2">50%</span></div>
                            <input type="range" id="textYSlider2" min="0" max="100" value="50">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>DÃ¶ndÃ¼rme</span><span id="textRotVal2">0Â°</span></div>
                            <input type="range" id="textRotSlider2" min="-180" max="180" value="0">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>ÅeffaflÄ±k</span><span id="textOpacityVal2">100%</span></div>
                            <input type="range" id="textOpacitySlider2" min="0" max="100" value="100">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>GÃ¶lge YoÄŸunluÄŸu</span><span id="shadowVal2">7</span></div>
                            <input type="range" id="shadowSlider2" min="0" max="30" value="7">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>SatÄ±r YÃ¼ksekliÄŸi</span><span id="lineHeightVal">1.3</span></div>
                            <input type="range" id="lineHeightSlider" min="8" max="30" value="13">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>Harf AralÄ±ÄŸÄ±</span><span id="letterSpacingVal">0px</span></div>
                            <input type="range" id="letterSpacingSlider" min="-5" max="20" value="0">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>Ã‡Ä±kÄ±ÅŸ (Outline) KalÄ±nlÄ±ÄŸÄ±</span><span id="outlineWidthVal">0px</span></div>
                            <input type="range" id="outlineWidthSlider" min="0" max="8" value="0">
                        </div>

                        <label style="font-size: 0.85em; color: #495057; font-weight: 600; display: block; margin-bottom: 8px;">Ã‡Ä±kÄ±ÅŸ Rengi</label>
                        <input type="color" id="outlineColorPicker" style="width: 100%; height: 35px; margin-bottom: 12px;" value="#000000">

                        <label style="font-size: 0.85em; color: #495057; font-weight: 600; display: block; margin-bottom: 8px;">Arka Plan Rengi (BoÅŸ ise kapalÄ±)</label>
                        <input type="color" id="bgColorPicker" style="width: 100%; height: 35px; margin-bottom: 8px;" value="#000000">

                        <div class="slider-container">
                            <div class="slider-label"><span>Arka Plan OpaklÄ±ÄŸÄ±</span><span id="bgOpacityVal2">100%</span></div>
                            <input type="range" id="bgOpacitySlider2" min="0" max="100" value="100">
                        </div>

                        <div class="slider-container">
                            <div class="slider-label"><span>Arka Plan Padding</span><span id="bgPaddingVal">10px</span></div>
                            <input type="range" id="bgPaddingSlider" min="0" max="30" value="10">
                        </div>

                        <div style="margin-top: 10px; padding: 10px; background: #e7f7e7; border-radius: 6px; border-left: 3px solid #28a745;">
                            <strong style="color: #155724; font-size: 0.9em;">ğŸ’¡ YazÄ± Ä°puÃ§larÄ±:</strong>
                            <div style="font-size: 0.75em; color: #155724; margin-top: 5px; line-height: 1.4;">
                                âœ“ Ã‡Ä±kÄ±ÅŸ = Metni dÄ±ÅŸtaraftan Ã§izgilerle Ã§erÃ§evele<br/>
                                âœ“ Arka Plan = Metni renkli kutu iÃ§ine al<br/>
                                âœ“ 48px+ baÅŸlÄ±k, 24-32px gÃ¶vde metni<br/>
                                âœ“ En fazla 3-4 yazÄ± katmanÄ± kullanÄ±n
                            </div>
                        </div>
                    </div>
                </div>

                <!-- LOGO -->
                <div class="section">
                    <h3>ğŸ¢ Logolar & Ä°konlar (Max 3)</h3>
                    <div id="logoList" style="max-height: 200px; overflow-y: auto; border-radius: 8px; padding: 5px; background: white;"></div>
                    <button class="btn btn-primary" id="logoUploadBtn" style="margin-top: 10px; font-size: 0.9em; padding: 10px;">
                        ğŸ“· Logo Ekle
                    </button>
                    <input type="file" id="logoImageInput" accept="image/*">
                    <button class="btn btn-primary" id="removeLogoBtn" style="margin-top: 8px; background: linear-gradient(135deg, #dc3545 0%, #c82333 100%); font-size: 0.9em; padding: 10px;">
                        ğŸ—‘ï¸ Logoyu Sil
                    </button>
                    <div style="margin-top: 8px; padding: 8px; background: #e7f3ff; border-radius: 6px; border-left: 3px solid var(--primary); font-size: 0.75em; color: #0066cc;">
                        ğŸ“Œ Logolar saÄŸ alt kÃ¶ÅŸeye taÅŸÄ± ve 100-150px olacak ÅŸekilde ayarla
                    </div>
                    <div id="logoControls" style="display:none; margin-top: 10px;">
                        <div class="slider-container">
                            <div class="slider-label"><span>Boyut</span><span id="logoSizeVal">100px</span></div>
                            <input type="range" id="logoSizeSlider" min="30" max="400" value="100">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label"><span>X (Sol-SaÄŸ)</span><span id="logoXVal">90%</span></div>
                            <input type="range" id="logoXSlider" min="0" max="100" value="90">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label"><span>Y (Ãœst-Alt)</span><span id="logoYVal">90%</span></div>
                            <input type="range" id="logoYSlider" min="0" max="100" value="90">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label"><span>DÃ¶ndÃ¼rme</span><span id="logoRotVal">0Â°</span></div>
                            <input type="range" id="logoRotSlider" min="0" max="360" value="0">
                        </div>
                        <div class="slider-container">
                            <div class="slider-label"><span>ÅeffaflÄ±k</span><span id="logoOpacityVal">100%</span></div>
                            <input type="range" id="logoOpacitySlider" min="0" max="100" value="100">
                        </div>
                    </div>
                </div>

                <!-- Ä°NDÄ°RME -->
                <div class="section">
                    <button class="btn btn-success" id="downloadBtn">
                        â¬‡ï¸ PNG Ä°ndir
                    </button>
                    <button class="btn btn-primary" id="resetBtn" style="background: linear-gradient(135deg, #6c757d 0%, #5a6268 100%); margin-top: 10px;">
                        ğŸ”„ SÄ±fÄ±rla
                    </button>
                </div>
            </div>

            <div class="canvas-container">
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </div>

    <!-- AI MODAL -->
    <div class="modal" id="aiModal">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <h2>ğŸ¤– Yapay Zeka TasarÄ±m AsistanÄ±</h2>
            
            <div class="tabs">
                <button class="tab-btn active" data-tab="0">ğŸ’¡ Ã–neriler</button>
                <button class="tab-btn" data-tab="1">ğŸ¨ Renkler</button>
                <button class="tab-btn" data-tab="2">âœï¸ Metinler</button>
                <button class="tab-btn" data-tab="3">ğŸ”§ Sorun Ã‡Ã¶zme</button>
                <button class="tab-btn" data-tab="4">ğŸ“š Kurallar</button>
                <button class="tab-btn" data-tab="5">âš™ï¸ Katman Ä°ÅŸlemleri</button>
            </div>

            <div id="tab0" class="tab-content active"></div>
            <div id="tab1" class="tab-content"></div>
            <div id="tab2" class="tab-content"></div>
            <div id="tab3" class="tab-content"></div>
            <div id="tab4" class="tab-content"></div>
            <div id="tab5" class="tab-content"></div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

</body>
</html>

    <script>
        // ============ STATE & CONSTANTS ============
        const canvas = document.getElementById('canvas');
        const ctx = canvas.getContext('2d');

        let state = {
            format: '1080x1080',
            gradient: 'grad1',
            filter: 'none',
            blur: 0,
            overlay: 0,
            brightness: 100,
            contrast: 100,
            saturate: 100,
            hue: 0,
            bgImage: null,
            bgOpacity: 100,
            bgScale: 100,
            bgRotation: 0,
            logos: [],
            activeLogo: -1,
            texts: [],
            activeText: -1,
            layers: [],
            activeLayer: 0
        };

        const formatMap = {
            '1080x1080': { w: 1080, h: 1080 },
            '1080x1920': { w: 1080, h: 1920 },
            '1200x630': { w: 1200, h: 630 },
            '1200x675': { w: 1200, h: 675 },
            '1200x627': { w: 1200, h: 627 },
            '1280x720': { w: 1280, h: 720 }
        };

        const gradientMap = {
            grad1: ['#667eea', '#764ba2'], grad2: ['#f093fb', '#f5576c'], grad3: ['#4facfe', '#00f2fe'],
            grad4: ['#43e97b', '#38f9d7'], grad5: ['#fa709a', '#fee140'], grad6: ['#30cfd0', '#330867'],
            grad7: ['#a8edea', '#fed6e3'], grad8: ['#ff9a9e', '#fecfef'], grad9: ['#ffecd2', '#fcb69f'],
            grad10: ['#ff6e7f', '#bfe9ff'], grad11: ['#e0c3fc', '#8ec5fc'], grad12: ['#f77062', '#fe5196'],
            grad13: ['#fd6e6a', '#bfeadb'], grad14: ['#ffecd2', '#fcb69f'], grad15: ['#ff9844', '#fe5196'],
            grad16: ['#667eea', '#764ba2'], grad17: ['#f5af19', '#f12711'], grad18: ['#56ab2f', '#a8e063'],
            grad19: ['#1e3c72', '#2a5298'], grad20: ['#eb3349', '#f45c43']
        };

        const colorPalettes = [
            { name: 'Modern Mavi', colors: ['#667eea', '#764ba2', '#f093fb', '#f5576c'] },
            { name: 'YeÅŸil DoÄŸa', colors: ['#43e97b', '#38f9d7', '#fa709a', '#fee140'] },
            { name: 'SÄ±cak Tones', colors: ['#ff6e7f', '#fcb69f', '#ffecd2', '#f77062'] },
            { name: 'Pastel', colors: ['#a8edea', '#fed6e3', '#ff9a9e', '#fecfef'] },
            { name: 'Elektrik', colors: ['#ff00ff', '#00ffff', '#ffff00', '#ff0080'] },
            { name: 'Klasik', colors: ['#000000', '#ffffff', '#ff0000', '#0000ff'] },
            { name: 'AltÄ±n', colors: ['#ffd700', '#ffed4e', '#ffa500', '#ff8c00'] },
            { name: 'Deniz', colors: ['#006994', '#0e9aa7', '#3da5c4', '#c1dbee'] }
        ];

        const textSuggestions = ['Ä°nsan KaynaklarÄ±', 'Pazarlama', 'ÃœrÃ¼n LansmanÄ±', 'Yeni Hizmet', 'Ã–zel Teklif', 'Haberler', 'Duyuru', 'Ä°ÅŸbirliÄŸi', 'BaÅŸarÄ±', 'Yeni Koleksiyon', 'Ä°ndirim', 'Kampanya', 'Etkinlik', 'Konferans', 'Web Ä°Ã§eriÄŸi', 'Sosyal Ä°Ã§erik', 'E-ticaret', 'Marka TanÄ±tÄ±mÄ±', 'Motivasyon', 'Ä°lham'];

        const designTips = [
            'âœ… 3 renkten fazla kullanmayÄ±n',
            'âœ… Kontrast Ã¶nemlidir - Koyu arka plan + aÃ§Ä±k metin',
            'âœ… Metin boyutu en az 36px olmalÄ±',
            'âœ… GÃ¶rseller merkezde olmadan 80% alan kullanmalÄ±',
            'âœ… Logo saÄŸ alt kÃ¶ÅŸede 100-150px boyutunda olmalÄ±',
            'âœ… Filtreleri hafif tutun (%40 ile %60 arasÄ±nda)',
            'âœ… Sans-serif fontlar web iÃ§in daha iyi',
            'âœ… BoÅŸluk (whitespace) profesyonellik gÃ¶sterir'
        ];

        // ============ SETUP FUNCTIONS ============
        function initGradients() {
            const grid = document.getElementById('gradientGrid');
            Object.entries(gradientMap).forEach(([key, [c1, c2]]) => {
                const el = document.createElement('div');
                el.className = 'preset-item' + (key === 'grad1' ? ' active' : '');
                el.setAttribute('data-grad', key);
                el.style.background = `linear-gradient(135deg, ${c1} 0%, ${c2} 100%)`;
                el.title = `TÄ±kla: Arka Plan - Ctrl+TÄ±kla: Metin Rengi`;
                el.onclick = (e) => {
                    if (e.ctrlKey) {
                        // Apply as text color from gradient
                        applyTextColor(c1);
                    } else {
                        selectGradient(key, el);
                    }
                };
                grid.appendChild(el);
            });
        }

        function setCanvasSize() {
            const size = formatMap[state.format];
            canvas.width = size.w;
            canvas.height = size.h;
            redraw();
        }

        function createLayer() {
            return {
                id: Date.now(),
                image: null,
                scale: 80,
                x: 50,
                y: 50,
                rot: 0,
                opacity: 100
            };
        }

        function createLogo() {
            return {
                id: Date.now(),
                image: null,
                size: 100,
                x: 90,
                y: 90,
                rot: 0,
                opacity: 100
            };
        }

        function createText() {
            return {
                id: Date.now(),
                content: 'Yeni YazÄ±',
                size: 48,
                family: 'Arial',
                color: '#ffffff',
                x: 50,
                y: 50,
                rot: 0,
                opacity: 100,
                shadow: 7,
                align: 'center',
                lineHeight: 1.3,
                letterSpacing: 0,
                outlineWidth: 0,
                outlineColor: '#000000',
                backgroundColor: null,
                backgroundPadding: 10,
                backgroundOpacity: 100
            };
        }

        function renderLayers() {
            const list = document.getElementById('layerList');
            list.innerHTML = '';
            state.layers.forEach((layer, i) => {
                const el = document.createElement('div');
                el.className = 'layer-item' + (i === state.activeLayer ? ' active' : '');
                el.innerHTML = `<strong>Katman ${i + 1}</strong><small>${layer.image ? 'âœ“ GÃ¶rsel YÃ¼klendi' : 'â—‹ BoÅŸ'}</small>`;
                el.onclick = () => selectLayer(i);
                list.appendChild(el);
            });
        }

        function renderLogos() {
            const list = document.getElementById('logoList');
            list.innerHTML = '';
            state.logos.forEach((logo, i) => {
                const el = document.createElement('div');
                el.className = 'logo-item' + (i === state.activeLogo ? ' active' : '');
                el.innerHTML = `<strong>Logo ${i + 1}</strong><small>${logo.image ? 'âœ“ YÃ¼klendi' : 'â—‹ BoÅŸ'}</small>`;
                el.onclick = () => selectLogo(i);
                list.appendChild(el);
            });
        }

        function renderTexts() {
            const list = document.getElementById('textList');
            if (!list) return;
            list.innerHTML = '';
            state.texts.forEach((text, i) => {
                const el = document.createElement('div');
                el.className = 'text-item' + (i === state.activeText ? ' active' : '');
                const preview = text.content.substring(0, 20) + (text.content.length > 20 ? '...' : '');
                el.innerHTML = `<strong>YazÄ± ${i + 1}</strong><small>"${preview}"</small>`;
                el.onclick = () => selectText(i);
                list.appendChild(el);
            });
        }

        function selectLayer(idx) {
            state.activeLayer = idx;
            renderLayers();
        }

        function selectLogo(idx) {
            state.activeLogo = idx;
            renderLogos();
            document.getElementById('logoControls').style.display = state.activeLogo >= 0 ? 'block' : 'none';
        }

        function selectText(idx) {
            state.activeText = idx;
            renderTexts();
            updateTextControls();
        }

        function updateTextControls() {
            const panel = document.getElementById('textAdvancedControls');
            if (!panel || state.activeText < 0 || !state.texts[state.activeText]) {
                if (panel) panel.style.display = 'none';
                return;
            }
            
            const text = state.texts[state.activeText];
            panel.style.display = 'block';
            
            document.getElementById('textContentInput').value = text.content;
            document.getElementById('textSizeSlider2').value = text.size;
            document.getElementById('textSizeVal2').textContent = text.size + 'px';
            document.getElementById('fontSelect2').value = text.family;
            document.getElementById('textColorPicker2').value = text.color;
            document.getElementById('textOpacitySlider2').value = text.opacity;
            document.getElementById('textOpacityVal2').textContent = text.opacity + '%';
            document.getElementById('shadowSlider2').value = text.shadow;
            document.getElementById('shadowVal2').textContent = text.shadow;
            document.getElementById('textXSlider2').value = text.x;
            document.getElementById('textXVal2').textContent = text.x + '%';
            document.getElementById('textYSlider2').value = text.y;
            document.getElementById('textYVal2').textContent = text.y + '%';
            document.getElementById('textRotSlider2').value = text.rot;
            document.getElementById('textRotVal2').textContent = text.rot + 'Â°';
            document.getElementById('lineHeightSlider').value = text.lineHeight * 10;
            document.getElementById('lineHeightVal').textContent = text.lineHeight.toFixed(1);
            document.getElementById('letterSpacingSlider').value = text.letterSpacing;
            document.getElementById('letterSpacingVal').textContent = text.letterSpacing + 'px';
            document.getElementById('outlineWidthSlider').value = text.outlineWidth || 0;
            document.getElementById('outlineWidthVal').textContent = (text.outlineWidth || 0) + 'px';
            document.getElementById('outlineColorPicker').value = text.outlineColor || '#000000';
            document.getElementById('bgColorPicker').value = text.backgroundColor || '#000000';
            document.getElementById('bgOpacitySlider2').value = text.backgroundOpacity || 100;
            document.getElementById('bgOpacityVal2').textContent = (text.backgroundOpacity || 100) + '%';
            document.getElementById('bgPaddingSlider').value = text.backgroundPadding || 10;
            document.getElementById('bgPaddingVal').textContent = (text.backgroundPadding || 10) + 'px';
            
            document.querySelectorAll('[data-align]').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-align="${text.align}"]`)?.classList.add('active');
        }

        function showNotif(msg) {
            const el = document.getElementById('notification');
            el.textContent = msg;
            el.style.display = 'block';
            setTimeout(() => el.style.display = 'none', 3000);
        }

        // Initialize function - will be called from part-7.html
        function initApp() {
            initGradients();
            state.layers.push(createLayer());
            state.texts.push(createText());
            state.activeText = 0;
            setCanvasSize();
            renderLayers();
            renderTexts();
            updateTextControls();
        }
    </script>

    <script>
        // ============ LAYER MANAGEMENT ============
        document.getElementById('addLayerBtn').insertAdjacentHTML('afterend', '<input type="file" id="layerImageInput" accept="image/*" style="display:none;">');
        const layerImageInput = document.getElementById('layerImageInput');

        document.getElementById('addLayerBtn').addEventListener('click', () => {
            if (state.layers.length < 10) {
                state.layers.push(createLayer());
                state.activeLayer = state.layers.length - 1;
                renderLayers();
                setTimeout(() => {
                    document.getElementById('layerImageInput').click();
                }, 100);
                showNotif('âœ“ Yeni katman eklendi!');
            } else {
                showNotif('âš ï¸ Maksimum 10 katman!');
            }
        });

        document.getElementById('removeLayerBtn').addEventListener('click', () => {
            if (state.layers.length > 1) {
                state.layers.splice(state.activeLayer, 1);
                if (state.activeLayer >= state.layers.length) state.activeLayer = state.layers.length - 1;
                renderLayers();
                redraw();
                showNotif('âœ“ Katman silindi!');
            } else {
                showNotif('âš ï¸ En az 1 katman olmalÄ±!');
            }
        });

        document.getElementById('dupLayerBtn').addEventListener('click', () => {
            if (state.layers.length < 10 && state.layers[state.activeLayer].image) {
                const activeLayer = state.layers[state.activeLayer];
                const clonedLayer = {
                    id: Date.now(),
                    image: activeLayer.image,
                    scale: activeLayer.scale,
                    x: activeLayer.x + 5,
                    y: activeLayer.y + 5,
                    rot: activeLayer.rot,
                    opacity: activeLayer.opacity
                };
                state.layers.push(clonedLayer);
                state.activeLayer = state.layers.length - 1;
                renderLayers();
                redraw();
                showNotif('âœ“ Katman klonlandÄ±!');
            } else if (state.layers.length >= 10) {
                showNotif('âš ï¸ Maksimum 10 katman!');
            } else {
                showNotif('âš ï¸ Klonlamak iÃ§in katmanda gÃ¶rsel olmalÄ±!');
            }
        });

        // ============ LAYER ADVANCED CONTROLS ============
        // Add layer scale slider after layer list
        const layerSection = document.querySelector('.section');
        const layerControls = document.createElement('div');
        layerControls.id = 'layerAdvancedControls';
        layerControls.style.marginTop = '15px';
        layerControls.style.display = 'none';
        layerControls.innerHTML = `
            <div style="background: #f0f4ff; padding: 12px; border-radius: 8px;">
                <div class="slider-container">
                    <div class="slider-label"><span>ğŸ“ Katman Boyutu</span><span id="layerScaleVal">80%</span></div>
                    <input type="range" id="layerScaleSlider" min="10" max="150" value="80">
                </div>
                <div class="slider-container">
                    <div class="slider-label"><span>ğŸŒ«ï¸ ÅeffaflÄ±k</span><span id="layerOpacityVal">100%</span></div>
                    <input type="range" id="layerOpacitySlider" min="0" max="100" value="100">
                </div>
                <div class="slider-container">
                    <div class="slider-label"><span>ğŸ”„ DÃ¶ndÃ¼rme</span><span id="layerRotVal">0Â°</span></div>
                    <input type="range" id="layerRotSlider" min="0" max="360" value="0">
                </div>
                <div class="slider-container">
                    <div class="slider-label"><span>â—€ï¸ X Pozisyon</span><span id="layerXVal">50%</span></div>
                    <input type="range" id="layerXSlider" min="0" max="100" value="50">
                </div>
                <div class="slider-container">
                    <div class="slider-label"><span>â–² Y Pozisyon</span><span id="layerYVal">50%</span></div>
                    <input type="range" id="layerYSlider" min="0" max="100" value="50">
                </div>
            </div>
        `;
        
        // Find the section after addLayerBtn and insert controls
        const addLayerBtn = document.getElementById('addLayerBtn');
        addLayerBtn.parentElement.insertBefore(layerControls, addLayerBtn);

        // Layer controls event listeners
        document.getElementById('layerScaleSlider')?.addEventListener('input', (e) => {
            if (state.activeLayer >= 0 && state.layers.length > 0) {
                state.layers[state.activeLayer].scale = parseInt(e.target.value);
                document.getElementById('layerScaleVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('layerOpacitySlider')?.addEventListener('input', (e) => {
            if (state.activeLayer >= 0 && state.layers.length > 0) {
                state.layers[state.activeLayer].opacity = parseInt(e.target.value);
                document.getElementById('layerOpacityVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('layerRotSlider')?.addEventListener('input', (e) => {
            if (state.activeLayer >= 0 && state.layers.length > 0) {
                state.layers[state.activeLayer].rot = parseInt(e.target.value);
                document.getElementById('layerRotVal').textContent = e.target.value + 'Â°';
                redraw();
            }
        });

        document.getElementById('layerXSlider')?.addEventListener('input', (e) => {
            if (state.activeLayer >= 0 && state.layers.length > 0) {
                state.layers[state.activeLayer].x = parseInt(e.target.value);
                document.getElementById('layerXVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('layerYSlider')?.addEventListener('input', (e) => {
            if (state.activeLayer >= 0 && state.layers.length > 0) {
                state.layers[state.activeLayer].y = parseInt(e.target.value);
                document.getElementById('layerYVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        // Update layer controls when a layer is selected
        const originalRenderLayers = renderLayers;
        renderLayers = function() {
            originalRenderLayers.call(this);
            
            const controls = document.getElementById('layerAdvancedControls');
            if (state.activeLayer >= 0 && state.layers[state.activeLayer]) {
                const layer = state.layers[state.activeLayer];
                controls.style.display = 'block';
                document.getElementById('layerScaleSlider').value = layer.scale;
                document.getElementById('layerScaleVal').textContent = layer.scale + '%';
                document.getElementById('layerOpacitySlider').value = layer.opacity;
                document.getElementById('layerOpacityVal').textContent = layer.opacity + '%';
                document.getElementById('layerRotSlider').value = layer.rot;
                document.getElementById('layerRotVal').textContent = layer.rot + 'Â°';
                document.getElementById('layerXSlider').value = layer.x;
                document.getElementById('layerXVal').textContent = layer.x + '%';
                document.getElementById('layerYSlider').value = layer.y;
                document.getElementById('layerYVal').textContent = layer.y + '%';
            } else {
                controls.style.display = 'none';
            }
        };

        layerImageInput.addEventListener('change', (e) => {
            if (e.target.files[0]) {
                loadLayerImage(e.target.files[0]);
            }
        });

        document.addEventListener('click', (e) => {
            const layerItem = e.target.closest('.layer-item');
            if (layerItem) {
                const layerIndex = Array.from(document.querySelectorAll('.layer-item')).indexOf(layerItem);
                state.activeLayer = layerIndex;
                renderLayers();
                setTimeout(() => {
                    document.getElementById('layerImageInput').click();
                }, 100);
            }
        });

        function loadLayerImage(file) {
            if (!file || !file.type.startsWith('image/')) {
                showNotif('âš ï¸ LÃ¼tfen geÃ§erli bir resim dosyasÄ± seÃ§iniz!');
                return;
            }

            const reader = new FileReader();
            reader.onerror = () => {
                showNotif('âŒ Resim yÃ¼klenirken hata oluÅŸtu!');
            };
            reader.onload = (e) => {
                const img = new Image();
                img.onerror = () => {
                    showNotif('âŒ Resim aÃ§Ä±lamadÄ±! LÃ¼tfen geÃ§erli bir resim seÃ§iniz.');
                };
                img.onload = () => {
                    if (state.activeLayer >= 0 && state.activeLayer < state.layers.length) {
                        state.layers[state.activeLayer].image = img;
                        renderLayers();
                        redraw();
                        showNotif('âœ“ GÃ¶rsel katmana yÃ¼klendi!');
                        analyzeImage(img);
                    }
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // ============ BACKGROUND MANAGEMENT ============
        document.getElementById('bgUploadBtn').addEventListener('click', () => {
            document.getElementById('bgImageInput').click();
        });

        document.getElementById('bgImageInput').addEventListener('change', (e) => {
            if (e.target.files[0]) {
                const file = e.target.files[0];
                if (!file.type.startsWith('image/')) {
                    showNotif('âš ï¸ LÃ¼tfen geÃ§erli bir resim dosyasÄ± seÃ§iniz!');
                    return;
                }
                const reader = new FileReader();
                reader.onerror = () => {
                    showNotif('âŒ Resim yÃ¼klenirken hata oluÅŸtu!');
                };
                reader.onload = (e) => {
                    const img = new Image();
                    img.onerror = () => {
                        showNotif('âŒ Arka plan resimi aÃ§Ä±lamadÄ±!');
                    };
                    img.onload = () => {
                        state.bgImage = img;
                        redraw();
                        showNotif('âœ“ Arka plan yÃ¼klendi!');
                    };
                    img.src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        document.getElementById('bgOpacitySlider').addEventListener('input', (e) => {
            state.bgOpacity = parseInt(e.target.value);
            document.getElementById('bgOpacityVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('bgScaleSlider').addEventListener('input', (e) => {
            state.bgScale = parseInt(e.target.value);
            document.getElementById('bgScaleVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('bgRotSlider').addEventListener('input', (e) => {
            state.bgRotation = parseInt(e.target.value);
            document.getElementById('bgRotVal').textContent = e.target.value + 'Â°';
            redraw();
        });
    </script>

    <script>
        // ============ LOGO MANAGEMENT ============
        document.getElementById('logoUploadBtn').addEventListener('click', () => {
            document.getElementById('logoImageInput').click();
        });

        document.getElementById('logoImageInput').addEventListener('change', (e) => {
            if (e.target.files[0]) {
                const file = e.target.files[0];
                if (!file.type.startsWith('image/')) {
                    showNotif('âš ï¸ LÃ¼tfen geÃ§erli bir resim dosyasÄ± seÃ§iniz!');
                    return;
                }
                if (state.logos.length < 3) {
                    const reader = new FileReader();
                    reader.onerror = () => {
                        showNotif('âŒ Logo yÃ¼klenirken hata oluÅŸtu!');
                    };
                    reader.onload = (e) => {
                        const img = new Image();
                        img.onerror = () => {
                            showNotif('âŒ Logo resimi aÃ§Ä±lamadÄ±!');
                        };
                        img.onload = () => {
                            const logo = createLogo();
                            logo.image = img;
                            state.logos.push(logo);
                            state.activeLogo = state.logos.length - 1;
                            renderLogos();
                            document.getElementById('logoControls').style.display = 'block';
                            redraw();
                            showNotif('âœ“ Logo yÃ¼klendi!');
                        };
                        img.src = e.target.result;
                    };
                    reader.readAsDataURL(file);
                } else {
                    showNotif('âš ï¸ Maksimum 3 logo!');
                }
            }
        });

        document.getElementById('removeLogoBtn').addEventListener('click', () => {
            if (state.activeLogo >= 0 && state.logos.length > 0) {
                state.logos.splice(state.activeLogo, 1);
                if (state.activeLogo >= state.logos.length) state.activeLogo = state.logos.length - 1;
                if (state.logos.length === 0) state.activeLogo = -1;
                renderLogos();
                document.getElementById('logoControls').style.display = state.activeLogo >= 0 ? 'block' : 'none';
                redraw();
                showNotif('âœ“ Logo silindi!');
            }
        });

        document.addEventListener('click', (e) => {
            const logoItem = e.target.closest('.logo-item');
            if (logoItem) {
                const logoIndex = Array.from(document.querySelectorAll('.logo-item')).indexOf(logoItem);
                state.activeLogo = logoIndex;
                renderLogos();
                document.getElementById('logoControls').style.display = 'block';
            }
        });

        document.getElementById('logoSizeSlider').addEventListener('input', (e) => {
            if (state.activeLogo >= 0) {
                state.logos[state.activeLogo].size = parseInt(e.target.value);
                document.getElementById('logoSizeVal').textContent = e.target.value + 'px';
                redraw();
            }
        });

        document.getElementById('logoXSlider').addEventListener('input', (e) => {
            if (state.activeLogo >= 0) {
                state.logos[state.activeLogo].x = parseInt(e.target.value);
                document.getElementById('logoXVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('logoYSlider').addEventListener('input', (e) => {
            if (state.activeLogo >= 0) {
                state.logos[state.activeLogo].y = parseInt(e.target.value);
                document.getElementById('logoYVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('logoRotSlider').addEventListener('input', (e) => {
            if (state.activeLogo >= 0) {
                state.logos[state.activeLogo].rot = parseInt(e.target.value);
                document.getElementById('logoRotVal').textContent = e.target.value + 'Â°';
                redraw();
            }
        });

        document.getElementById('logoOpacitySlider').addEventListener('input', (e) => {
            if (state.activeLogo >= 0) {
                state.logos[state.activeLogo].opacity = parseInt(e.target.value);
                document.getElementById('logoOpacityVal').textContent = e.target.value + '%';
                redraw();
            }
        });

        // ============ AI MODAL ============
        const aiModal = document.getElementById('aiModal');
        const modalClose = document.querySelector('.modal-close');

        document.getElementById('aiBtn').addEventListener('click', () => {
            aiModal.classList.add('active');
            loadAISuggestions();
        });

        document.getElementById('aiAutoBtn').addEventListener('click', () => {
            applyAutoDesign();
        });

        modalClose.addEventListener('click', () => {
            aiModal.classList.remove('active');
        });

        document.querySelectorAll('.tab-btn').forEach((btn, idx) => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
                btn.classList.add('active');
                document.getElementById(`tab${idx}`).classList.add('active');
            });
        });

        function loadAISuggestions() {
            // Tab 0: Ã–neriler
            let html = '<h4 style="color: var(--primary); margin-bottom: 12px;">ğŸ¨ TasarÄ±m Ã–nerileri</h4>';
            html += '<div class="ai-suggestion" onclick="applyFilter(\'bright\')">â˜€ï¸ Parlak Filtre - GÃ¶rselleri canlÄ±laÅŸtÄ±r</div>';
            html += '<div class="ai-suggestion" onclick="applyFilter(\'vintage\')">ğŸ“¸ Vintage Stil - Profesyonel gÃ¶rÃ¼nÃ¼m</div>';
            html += '<div class="ai-suggestion" onclick="changeOpacity()">ğŸŒ«ï¸ OpaklÄ±ÄŸÄ± ArtÄ±r - Arka plan etkisi</div>';
            html += '<div class="ai-suggestion" onclick="improveContrast()">ğŸ“Š KontrastÄ± GÃ¼Ã§lendir - Metin okunabilir</div>';
            html += '<div class="ai-suggestion" onclick="centerContent()">ğŸ¯ Merkeze Ortala - Dengeli tasarÄ±m</div>';
            html += '<div class="ai-suggestion" onclick="optimizeText()">âœï¸ Metin Optimize - Boyut iyileÅŸtir</div>';
            html += '<div class="ai-suggestion" onclick="applySaturation()">ğŸ¨ Renk CanlÄ±lÄ±ÄŸÄ± - Saturasyonu artÄ±r</div>';
            html += '<div class="ai-suggestion" onclick="applyWarmFilter()">ğŸ”¥ SÄ±cak Tonlar - Solgun resimlere uygun</div>';
            document.getElementById('tab0').innerHTML = html;

            // Tab 1: Renkler
            let colorHtml = '<h4 style="color: var(--primary); margin-bottom: 12px;">ğŸ¨ Renk Paletleri</h4>';
            colorPalettes.forEach((palette) => {
                colorHtml += `<div style="margin-bottom: 15px;"><strong style="display: block; margin-bottom: 8px; color: #495057;">${palette.name}</strong>`;
                palette.colors.forEach(color => {
                    colorHtml += `<div style="background: ${color}; height: 35px; border-radius: 6px; margin-bottom: 6px; cursor: pointer; transition: all 0.3s;" onmouseover="this.style.boxShadow='0 4px 12px rgba(0,0,0,0.3)'" onmouseout="this.style.boxShadow='none'" onclick="applyTextColor('${color}')" title="Metin rengi olarak uygula"></div>`;
                });
                colorHtml += '</div>';
            });
            document.getElementById('tab1').innerHTML = colorHtml;

            // Tab 2: Metinler
            let textHtml = '<h4 style="color: var(--primary); margin-bottom: 12px;">âœï¸ Metin ÅablonlarÄ± (20+)</h4>';
            textSuggestions.forEach(text => {
                textHtml += `<div class="ai-suggestion" onclick="applyTextSuggestion('${text}')">${text}</div>`;
            });
            document.getElementById('tab2').innerHTML = textHtml;

            // Tab 3: Sorun Ã‡Ã¶zme
            let troubleHtml = '<h4 style="color: var(--primary); margin-bottom: 12px;">ğŸ”§ SÄ±k Sorunlar & Otomatik Ã‡Ã¶zÃ¼mler</h4>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixReadability()">âŒ Metin OkunamÄ±yor â†’ âœ… Okunabilirlik ArttÄ±r</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixBalance()">âŒ GÃ¶rsel Dengesiz â†’ âœ… Merkeze Ortala</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixProfessional()">âŒ DÃ¼z GÃ¶rÃ¼nÃ¼yor â†’ âœ… Filtre & Efekt</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixCompression()">âŒ BoÄŸuk Ä°Ã§erik â†’ âœ… AÃ§Ä±klÄ±k Ekle</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixMobile()">âŒ Mobilde GÃ¶rÃ¼nmÃ¼yor â†’ âœ… Metin BÃ¼yÃ¼t</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="fixBrightness()">âŒ Ã‡ok Koyu â†’ âœ… ParlaklÄ±k ArtÄ±r</div>';
            troubleHtml += '<div class="ai-suggestion" onclick="improveContrast()">âŒ KontrastlÄ± DeÄŸil â†’ âœ… Kontrast GÃ¼Ã§lendir</div>';
            document.getElementById('tab3').innerHTML = troubleHtml;

            // Tab 4: TasarÄ±m KurallarÄ±
            let tipsHtml = '<h4 style="color: var(--primary); margin-bottom: 12px;">ğŸ“š Profesyonel TasarÄ±m KurallarÄ±</h4>';
            designTips.forEach(tip => {
                tipsHtml += `<div style="padding: 10px; background: #f0f4ff; border-left: 3px solid var(--success); border-radius: 4px; margin-bottom: 8px; font-size: 0.9em;">${tip}</div>`;
            });
            document.getElementById('tab4').innerHTML = tipsHtml;

            // Tab 5: Katman Ä°ÅŸlemleri
            let layerHtml = '<h4 style="color: var(--primary); margin-bottom: 12px;">âš™ï¸ Katman Ä°ÅŸlemleri</h4>';
            layerHtml += '<div class="ai-suggestion" onclick="distributeLayersEvenly()">ğŸ“ KatmanlarÄ± DÃ¼zenli DaÄŸÄ±t</div>';
            layerHtml += '<div class="ai-suggestion" onclick="alignLayersCenter()">ğŸ¯ TÃ¼m KatmanlarÄ± Merkeze Al</div>';
            layerHtml += '<div class="ai-suggestion" onclick="equalizeLayerOpacity()">ğŸŒ«ï¸ KatmanlarÄ± SayÄ±ÅŸtÄ±r (Opacity)</div>';
            layerHtml += '<div class="ai-suggestion" onclick="rotateAllLayers()">ğŸ”„ KatmanlarÄ± DÃ¶ndÃ¼r (30Â°)</div>';
            document.getElementById('tab5').innerHTML = layerHtml;
        }

        function analyzeImage(img) {
            const canvas_temp = document.createElement('canvas');
            canvas_temp.width = img.width;
            canvas_temp.height = img.height;
            const ctx_temp = canvas_temp.getContext('2d');
            ctx_temp.drawImage(img, 0, 0);
            
            const imageData = ctx_temp.getImageData(0, 0, 1, 1);
            const isDark = (imageData.data[0] + imageData.data[1] + imageData.data[2]) / 3 < 128;
            
            if (isDark) {
                document.getElementById('textColorPicker').value = '#ffffff';
                state.text.color = '#ffffff';
            } else {
                document.getElementById('textColorPicker').value = '#000000';
                state.text.color = '#000000';
            }
            redraw();
        }
    </script>

    <script>
        // ============ CANVAS RENDERING ============
        function selectGradient(id, el) {
            document.querySelectorAll('.preset-item').forEach(e => e.classList.remove('active'));
            el.classList.add('active');
            state.gradient = id;
            state.bgImage = null;
            redraw();
        }

        function redraw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBg();
            state.layers.forEach(layer => {
                if (layer.image) drawLayer(layer);
            });
            state.logos.forEach(logo => {
                if (logo.image) drawLogo(logo);
            });
            state.texts.forEach(text => {
                if (text.content) drawText(text);
            });
        }

        function drawBg() {
            if (state.bgImage) {
                ctx.save();
                if (state.blur > 0) ctx.filter = `blur(${state.blur}px)`;
                
                const img = state.bgImage;
                const ratio = img.width / img.height;
                const canvRatio = canvas.width / canvas.height;
                let w, h;
                
                if (ratio > canvRatio) {
                    h = canvas.height;
                    w = h * ratio;
                } else {
                    w = canvas.width;
                    h = w / ratio;
                }
                
                const scaleFactor = state.bgScale / 100;
                w *= scaleFactor;
                h *= scaleFactor;
                
                ctx.globalAlpha = state.bgOpacity / 100;
                ctx.translate(canvas.width / 2, canvas.height / 2);
                ctx.rotate((state.bgRotation * Math.PI) / 180);
                ctx.drawImage(img, -w / 2, -h / 2, w, h);
                ctx.restore();
            } else {
                const grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
                const cols = gradientMap[state.gradient];
                grad.addColorStop(0, cols[0]);
                grad.addColorStop(1, cols[1]);
                ctx.fillStyle = grad;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }

            if (state.overlay > 0) {
                ctx.fillStyle = `rgba(0, 0, 0, ${state.overlay / 100})`;
                ctx.fillRect(0, 0, canvas.width, canvas.height);
            }
        }

        function drawLayer(layer) {
            ctx.save();
            
            let filterStr = `brightness(${state.brightness}%) contrast(${state.contrast}%) saturate(${state.saturate}%) hue-rotate(${state.hue}deg)`;
            if (state.filter === 'gray') filterStr += ' grayscale(100%)';
            else if (state.filter === 'sepia') filterStr += ' sepia(100%)';
            else if (state.filter === 'bright') filterStr += ' brightness(130%) saturate(120%)';
            else if (state.filter === 'dark') filterStr += ' brightness(70%) contrast(120%)';
            else if (state.filter === 'vintage') filterStr += ' sepia(50%) contrast(120%) brightness(110%)';
            else if (state.filter === 'cool') filterStr += ' hue-rotate(240deg) saturate(120%)';
            else if (state.filter === 'warm') filterStr += ' hue-rotate(20deg) saturate(130%) brightness(110%)';
            else if (state.filter === 'neon') filterStr += ' contrast(150%) saturate(200%) brightness(110%)';
            else if (state.filter === 'invert') filterStr += ' invert(100%)';
            else if (state.filter === 'saturate') filterStr += ' saturate(180%)';
            else if (state.filter === 'duotone') filterStr += ' grayscale(100%) contrast(150%)';
            ctx.filter = filterStr;

            const img = layer.image;
            const ratio = img.width / img.height;
            const canvRatio = canvas.width / canvas.height;
            
            let baseW, baseH;
            if (ratio > canvRatio) {
                baseW = canvas.width * 0.8;
                baseH = baseW / ratio;
            } else {
                baseH = canvas.height * 0.8;
                baseW = baseH * ratio;
            }

            const w = baseW * (layer.scale / 100);
            const h = baseH * (layer.scale / 100);
            const x = canvas.width * (layer.x / 100);
            const y = canvas.height * (layer.y / 100);

            ctx.globalAlpha = layer.opacity / 100;
            ctx.translate(x, y);
            ctx.rotate((layer.rot * Math.PI) / 180);
            ctx.drawImage(img, -w / 2, -h / 2, w, h);
            ctx.restore();
        }

        function drawText(text) {
            if (!text) return;
            ctx.save();

            const x = canvas.width * (text.x / 100);
            const y = canvas.height * (text.y / 100);

            ctx.font = `bold ${text.size}px ${text.family}`;
            ctx.fillStyle = text.color;
            ctx.globalAlpha = text.opacity / 100;
            ctx.textAlign = text.align;
            ctx.shadowColor = 'rgba(0, 0, 0, 0.7)';
            ctx.shadowBlur = text.shadow;
            ctx.shadowOffsetX = 2;
            ctx.shadowOffsetY = 2;
            ctx.letterSpacing = text.letterSpacing + 'px';

            ctx.translate(x, y);
            ctx.rotate((text.rot * Math.PI) / 180);

            const lines = text.content.split('\n');
            const lineH = text.size * text.lineHeight;
            const startY = -((lines.length - 1) * lineH) / 2;

            // Draw background if enabled
            if (text.backgroundColor) {
                ctx.globalAlpha = (text.opacity / 100) * (text.backgroundOpacity / 100);
                ctx.fillStyle = text.backgroundColor;
                let maxWidth = 0;
                lines.forEach(line => {
                    const metrics = ctx.measureText(line);
                    maxWidth = Math.max(maxWidth, metrics.width);
                });
                const bgPadding = text.backgroundPadding;
                const bgX = text.align === 'center' ? -maxWidth / 2 - bgPadding : 
                           text.align === 'right' ? -maxWidth - bgPadding : -bgPadding;
                const bgY = startY - text.size * 0.3 - bgPadding;
                const bgW = maxWidth + bgPadding * 2;
                const bgH = (lines.length * lineH) + bgPadding * 2;
                ctx.fillRect(bgX, bgY, bgW, bgH);
            }

            // Draw text with optional outline
            ctx.globalAlpha = text.opacity / 100;
            ctx.fillStyle = text.color;
            
            if (text.outlineWidth > 0) {
                ctx.strokeStyle = text.outlineColor;
                ctx.lineWidth = text.outlineWidth;
                ctx.lineJoin = 'round';
                lines.forEach((line, i) => {
                    ctx.strokeText(line, 0, startY + (i * lineH));
                });
            }

            lines.forEach((line, i) => {
                ctx.fillText(line, 0, startY + (i * lineH));
            });

            ctx.restore();
        }

        function drawLogo(logo) {
            ctx.save();

            const img = logo.image;
            const ratio = img.width / img.height;
            
            let w = logo.size;
            let h = w / ratio;

            const x = canvas.width * (logo.x / 100);
            const y = canvas.height * (logo.y / 100);

            ctx.globalAlpha = logo.opacity / 100;
            ctx.translate(x, y);
            ctx.rotate((logo.rot * Math.PI) / 180);
            ctx.drawImage(img, -w / 2, -h / 2, w, h);
            ctx.restore();
        }
    </script>

    <script>
        // ============ EVENT LISTENERS ============
        document.querySelectorAll('[data-fmt]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-fmt]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.format = this.dataset.fmt;
                setCanvasSize();
            });
        });

        document.querySelectorAll('[data-flt]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-flt]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.filter = this.dataset.flt;
                redraw();
            });
        });

        document.querySelectorAll('[data-align]').forEach(btn => {
            btn.addEventListener('click', function() {
                document.querySelectorAll('[data-align]').forEach(b => b.classList.remove('active'));
                this.classList.add('active');
                state.textAlign = this.dataset.align;
                redraw();
            });
        });

        document.getElementById('blurSlider').addEventListener('input', (e) => {
            state.blur = parseInt(e.target.value);
            document.getElementById('blurVal').textContent = e.target.value + 'px';
            redraw();
        });

        document.getElementById('overlaySlider').addEventListener('input', (e) => {
            state.overlay = parseInt(e.target.value);
            document.getElementById('overlayVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('brightnessSlider').addEventListener('input', (e) => {
            state.brightness = parseInt(e.target.value);
            document.getElementById('brightnessVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('contrastSlider').addEventListener('input', (e) => {
            state.contrast = parseInt(e.target.value);
            document.getElementById('contrastVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('saturateSlider').addEventListener('input', (e) => {
            state.saturate = parseInt(e.target.value);
            document.getElementById('saturateVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('hueSlider').addEventListener('input', (e) => {
            state.hue = parseInt(e.target.value);
            document.getElementById('hueVal').textContent = e.target.value + 'Â°';
            redraw();
        });

        document.getElementById('fontSizeSlider').addEventListener('input', (e) => {
            state.text.size = parseInt(e.target.value);
            document.getElementById('fontSizeVal').textContent = e.target.value + 'px';
            redraw();
        });

        document.getElementById('fontSelect').addEventListener('change', (e) => {
            state.text.family = e.target.value;
            redraw();
        });

        document.getElementById('textColorPicker').addEventListener('input', (e) => {
            state.text.color = e.target.value;
            redraw();
        });

        document.getElementById('textOpacitySlider').addEventListener('input', (e) => {
            state.text.opacity = parseInt(e.target.value);
            document.getElementById('textOpacityVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('shadowSlider').addEventListener('input', (e) => {
            state.text.shadow = parseInt(e.target.value);
            document.getElementById('shadowVal').textContent = e.target.value;
            redraw();
        });

        document.getElementById('textArea').addEventListener('input', (e) => {
            state.text.content = e.target.value;
            redraw();
        });

        document.getElementById('textXSlider').addEventListener('input', (e) => {
            state.text.x = parseInt(e.target.value);
            document.getElementById('textXVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('textYSlider').addEventListener('input', (e) => {
            state.text.y = parseInt(e.target.value);
            document.getElementById('textYVal').textContent = e.target.value + '%';
            redraw();
        });

        document.getElementById('textRotSlider').addEventListener('input', (e) => {
            state.text.rot = parseInt(e.target.value);
            document.getElementById('textRotVal').textContent = e.target.value + 'Â°';
            redraw();
        });

        document.getElementById('downloadBtn').addEventListener('click', () => {
            const link = document.createElement('a');
            const timestamp = new Date().toISOString().slice(0, 10);
            link.download = `design-${timestamp}-${Math.random().toString(36).substr(2, 9)}.png`;
            link.href = canvas.toDataURL('image/png', 1.0);
            link.click();
            showNotif('âœ“ GÃ¶rsel indirildi!');
            
            // Copy to clipboard too
            try {
                canvas.toBlob((blob) => {
                    navigator.clipboard.write([
                        new ClipboardItem({ 'image/png': blob })
                    ]).then(() => {
                        showNotif('âœ“ GÃ¶rsel panoya da kopyalandÄ±!');
                    }).catch(() => {
                        // Silent fail, download is success
                    });
                });
            } catch(e) {
                // Silent fail
            }
        });

        document.getElementById('resetBtn').addEventListener('click', () => {
            if (confirm('TÃ¼m deÄŸiÅŸiklikleri sÄ±fÄ±rlamak istiyor musunuz?')) location.reload();
        });

        // ============ TEXT MANAGEMENT ============
        document.getElementById('addTextBtn')?.addEventListener('click', () => {
            if (state.texts.length < 20) {
                state.texts.push(createText());
                state.activeText = state.texts.length - 1;
                renderTexts();
                updateTextControls();
                redraw();
                showNotif('âœ“ Yeni yazÄ± eklendi! (Max 20)');
            } else {
                showNotif('âš ï¸ Maksimum 20 yazÄ±!');
            }
        });

        document.getElementById('removeTextBtn')?.addEventListener('click', () => {
            if (state.texts.length > 0 && state.activeText >= 0) {
                state.texts.splice(state.activeText, 1);
                state.activeText = Math.max(0, state.activeText - 1);
                renderTexts();
                updateTextControls();
                redraw();
                showNotif('âœ“ YazÄ± silindi!');
            } else {
                showNotif('âš ï¸ Silinecek yazÄ± yok!');
            }
        });

        document.getElementById('removeTextBtn')?.addEventListener('click', () => {
            if (state.texts.length > 0 && state.activeText >= 0) {
                state.texts.splice(state.activeText, 1);
                state.activeText = Math.max(0, state.activeText - 1);
                renderTexts();
                updateTextControls();
                redraw();
                showNotif('âœ“ YazÄ± silindi!');
            } else {
                showNotif('âš ï¸ Silinecek yazÄ± yok!');
            }
        });

        document.getElementById('dupTextBtn')?.addEventListener('click', () => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                if (state.texts.length < 20) {
                    const cloned = JSON.parse(JSON.stringify(state.texts[state.activeText]));
                    cloned.id = Date.now();
                    cloned.x = Math.min(100, cloned.x + 5);
                    cloned.y = Math.min(100, cloned.y + 5);
                    state.texts.push(cloned);
                    state.activeText = state.texts.length - 1;
                    renderTexts();
                    updateTextControls();
                    redraw();
                    showNotif('âœ“ YazÄ± klonlandÄ±! (Ctrl+Alt+C)');
                } else {
                    showNotif('âš ï¸ Maksimum 20 yazÄ±!');
                }
            }
        });

        document.getElementById('textContentInput')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].content = e.target.value;
                renderTexts();
                redraw();
            }
        });

        document.getElementById('textSizeSlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].size = parseInt(e.target.value);
                document.getElementById('textSizeVal2').textContent = e.target.value + 'px';
                redraw();
            }
        });

        document.getElementById('fontSelect2')?.addEventListener('change', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].family = e.target.value;
                redraw();
            }
        });

        document.getElementById('textColorPicker2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].color = e.target.value;
                redraw();
            }
        });

        document.getElementById('textOpacitySlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].opacity = parseInt(e.target.value);
                document.getElementById('textOpacityVal2').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('shadowSlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].shadow = parseInt(e.target.value);
                document.getElementById('shadowVal2').textContent = e.target.value;
                redraw();
            }
        });

        document.getElementById('textXSlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].x = parseInt(e.target.value);
                document.getElementById('textXVal2').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('textYSlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].y = parseInt(e.target.value);
                document.getElementById('textYVal2').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('textRotSlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].rot = parseInt(e.target.value);
                document.getElementById('textRotVal2').textContent = e.target.value + 'Â°';
                redraw();
            }
        });

        document.getElementById('lineHeightSlider')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].lineHeight = parseInt(e.target.value) / 10;
                document.getElementById('lineHeightVal').textContent = (parseInt(e.target.value) / 10).toFixed(1);
                redraw();
            }
        });

        document.getElementById('letterSpacingSlider')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].letterSpacing = parseInt(e.target.value);
                document.getElementById('letterSpacingVal').textContent = e.target.value + 'px';
                redraw();
            }
        });

        document.getElementById('outlineWidthSlider')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].outlineWidth = parseInt(e.target.value);
                document.getElementById('outlineWidthVal').textContent = e.target.value + 'px';
                redraw();
            }
        });

        document.getElementById('outlineColorPicker')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].outlineColor = e.target.value;
                redraw();
            }
        });

        document.getElementById('bgColorPicker')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].backgroundColor = e.target.value;
                redraw();
            }
        });

        document.getElementById('bgOpacitySlider2')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].backgroundOpacity = parseInt(e.target.value);
                document.getElementById('bgOpacityVal2').textContent = e.target.value + '%';
                redraw();
            }
        });

        document.getElementById('bgPaddingSlider')?.addEventListener('input', (e) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].backgroundPadding = parseInt(e.target.value);
                document.getElementById('bgPaddingVal').textContent = e.target.value + 'px';
                redraw();
            }
        });

        // Text alignment buttons
        document.querySelectorAll('[data-align]').forEach(btn => {
            btn.addEventListener('click', function() {
                if (state.activeText >= 0 && state.texts[state.activeText]) {
                    document.querySelectorAll('[data-align]').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    state.texts[state.activeText].align = this.getAttribute('data-align');
                    redraw();
                }
            });
        });
    </script>

    <script>
        // ============ AI FUNCTIONS ============
        window.applyFilter = (flt) => {
            document.querySelectorAll('[data-flt]').forEach(b => b.classList.remove('active'));
            document.querySelector(`[data-flt="${flt}"]`).classList.add('active');
            state.filter = flt;
            redraw();
            showNotif('âœ“ Filtre uygulandÄ±!');
        };

        window.changeOpacity = () => {
            document.getElementById('overlaySlider').value = 40;
            state.overlay = 40;
            document.getElementById('overlayVal').textContent = '40%';
            redraw();
            showNotif('âœ“ OpaklÄ±k ayarlandÄ±!');
        };

        window.improveContrast = () => {
            document.getElementById('contrastSlider').value = 130;
            state.contrast = 130;
            document.getElementById('contrastVal').textContent = '130%';
            redraw();
            showNotif('âœ“ Kontrast gÃ¼Ã§lendirildi!');
        };

        window.centerContent = () => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].x = 50;
                state.texts[state.activeText].y = 50;
                updateTextControls();
                redraw();
                showNotif('âœ“ Merkeze yer alÄ±ndÄ±!');
            }
        };

        window.optimizeText = () => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].size = 56;
                updateTextControls();
                redraw();
                showNotif('âœ“ Metin boyutu optimize edildi!');
            }
        };

        window.applySaturation = () => {
            document.getElementById('saturateSlider').value = 150;
            state.saturate = 150;
            document.getElementById('saturateVal').textContent = '150%';
            redraw();
            showNotif('âœ“ Renk canlÄ±lÄ±ÄŸÄ± arttÄ±rÄ±ldÄ±!');
        };

        window.applyWarmFilter = () => {
            applyFilter('warm');
        };

        window.applyTextColor = (color) => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].color = color;
                updateTextControls();
                redraw();
                showNotif('âœ“ Metin rengi uygulandÄ±!');
            }
        };

        window.applyGradientBackground = (gradId) => {
            const gradients = {
                'grad1': ['#667eea', '#764ba2'],
                'grad2': ['#f093fb', '#f5576c'],
                'grad3': ['#4facfe', '#00f2fe'],
                'grad4': ['#43e97b', '#38f9d7'],
                'grad5': ['#fa709a', '#fee140'],
                'grad6': ['#30cfd0', '#330867'],
                'grad7': ['#a8edea', '#fed6e3'],
                'grad8': ['#ff9a9e', '#fecfef'],
                'grad9': ['#ffecd2', '#fcb69f'],
                'grad10': ['#ff6e7f', '#bfe9ff'],
                'grad11': ['#e0c3fc', '#8ec5fc'],
                'grad12': ['#f77062', '#fe5196'],
                'grad13': ['#fd6e6a', '#bfeadb'],
                'grad14': ['#ffecd2', '#fcb69f'],
                'grad15': ['#ff9844', '#fe5196'],
                'grad16': ['#667eea', '#764ba2'],
                'grad17': ['#f5af19', '#f12711'],
                'grad18': ['#56ab2f', '#a8e063'],
                'grad19': ['#1e3c72', '#2a5298'],
                'grad20': ['#eb3349', '#f45c43']
            };
            
            if (gradients[gradId]) {
                state.gradient = gradId;
                state.bgImage = null;
                document.querySelectorAll('.preset-item').forEach(el => el.classList.remove('active'));
                document.querySelector(`[data-grad="${gradId}"]`)?.classList.add('active');
                redraw();
                showNotif('âœ“ Gradient arka planÄ± uygulandÄ±!');
            }
        };

        window.applyTextSuggestion = (text) => {
            if (state.texts.length >= 20) {
                showNotif('âš ï¸ Maksimum 20 yazÄ±! Yeni eklemek iÃ§in eski birini silin.');
                return;
            }
            state.texts.push(createText());
            state.activeText = state.texts.length - 1;
            state.texts[state.activeText].content = text;
            state.texts[state.activeText].size = 54;
            renderTexts();
            updateTextControls();
            redraw();
            showNotif('âœ“ Yeni yazÄ± Ã¶nerisi eklendi!');
        };

        window.fixReadability = () => {
            improveContrast();
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].size = 64;
                state.texts[state.activeText].color = '#ffffff';
                state.texts[state.activeText].shadow = 10;
                updateTextControls();
            }
            redraw();
            showNotif('âœ“ Okunabilirlik iyileÅŸtirildi!');
        };

        window.fixBalance = () => {
            centerContent();
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].size = 52;
                updateTextControls();
            }
            redraw();
        };

        window.fixProfessional = () => {
            applyFilter('vintage');
            improveContrast();
            document.getElementById('saturateSlider').value = 120;
            state.saturate = 120;
            document.getElementById('saturateVal').textContent = '120%';
            redraw();
            showNotif('âœ“ Profesyonel gÃ¶rÃ¼nÃ¼m uygulandÄ±!');
        };

        window.fixCompression = () => {
            document.getElementById('overlaySlider').value = 20;
            state.overlay = 20;
            document.getElementById('overlayVal').textContent = '20%';
            redraw();
            showNotif('âœ“ AÃ§Ä±klÄ±k ve netlik iyileÅŸtirildi!');
        };

        window.fixMobile = () => {
            if (state.activeText >= 0 && state.texts[state.activeText]) {
                state.texts[state.activeText].size = 72;
                updateTextControls();
            }
            redraw();
            showNotif('âœ“ Mobil uyumluluÄŸu arttÄ±rÄ±ldÄ±!');
        };

        window.fixBrightness = () => {
            document.getElementById('brightnessSlider').value = 130;
            state.brightness = 130;
            document.getElementById('brightnessVal').textContent = '130%';
            redraw();
            showNotif('âœ“ ParlaklÄ±k iyileÅŸtirildi!');
        };

        window.distributeLayersEvenly = () => {
            if (state.layers.length < 2) return;
            const spacing = 100 / (state.layers.length + 1);
            state.layers.forEach((layer, i) => {
                layer.x = spacing * (i + 1);
                layer.y = 50;
            });
            redraw();
            showNotif('âœ“ Katmanlar dÃ¼zenli daÄŸÄ±tÄ±ldÄ±!');
        };

        window.alignLayersCenter = () => {
            state.layers.forEach(layer => {
                layer.x = 50;
                layer.y = 50;
            });
            redraw();
            showNotif('âœ“ TÃ¼m katmanlar merkeze alÄ±ndÄ±!');
        };

        window.equalizeLayerOpacity = () => {
            const avgOpacity = 70;
            state.layers.forEach(layer => {
                layer.opacity = avgOpacity;
            });
            redraw();
            showNotif('âœ“ KatmanlarÄ±n ÅŸeffaflÄ±ÄŸÄ± sayÄ±ÅŸtÄ±rÄ±ldÄ±!');
        };

        window.rotateAllLayers = () => {
            state.layers.forEach(layer => {
                layer.rot = (layer.rot + 30) % 360;
            });
            redraw();
            showNotif('âœ“ Katmanlar 30Â° dÃ¶ndÃ¼rÃ¼ldÃ¼!');
        };

        // Text batch operations
        window.applyTextEffectAll = () => {
            state.texts.forEach(text => {
                text.shadow = 10;
                text.outlineWidth = 2;
                text.outlineColor = '#000000';
                text.opacity = 100;
            });
            updateTextControls();
            redraw();
            showNotif('âœ“ TÃ¼m yazÄ±lara efekt uygulandÄ±!');
        };

        window.centerAllTexts = () => {
            state.texts.forEach(text => {
                text.align = 'center';
                text.x = 50;
            });
            updateTextControls();
            redraw();
            showNotif('âœ“ TÃ¼m yazÄ±lar merkeze alÄ±ndÄ±!');
        };

        window.enlargeAllTexts = () => {
            state.texts.forEach(text => {
                if (text.size < 72) {
                    text.size = Math.min(200, text.size * 1.2);
                }
            });
            updateTextControls();
            redraw();
            showNotif('âœ“ TÃ¼m yazÄ±lar bÃ¼yÃ¼tÃ¼ldÃ¼!');
        };

        window.applyBackgroundAllTexts = () => {
            state.texts.forEach(text => {
                text.backgroundColor = '#000000';
                text.backgroundOpacity = 70;
                text.backgroundPadding = 15;
            });
            updateTextControls();
            redraw();
            showNotif('âœ“ TÃ¼m yazÄ±lara arka plan eklendi!');
        };
        };

        function applyAutoDesign() {
            state.filter = 'vintage';
            document.querySelectorAll('[data-flt]').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-flt="vintage"]').classList.add('active');
            
            document.getElementById('contrastSlider').value = 125;
            state.contrast = 125;
            document.getElementById('contrastVal').textContent = '125%';
            
            document.getElementById('brightnessSlider').value = 115;
            state.brightness = 115;
            document.getElementById('brightnessVal').textContent = '115%';
            
            document.getElementById('saturateSlider').value = 130;
            state.saturate = 130;
            document.getElementById('saturateVal').textContent = '130%';
            
            document.getElementById('overlaySlider').value = 30;
            state.overlay = 30;
            document.getElementById('overlayVal').textContent = '30%';
            
            state.text.color = '#ffffff';
            document.getElementById('textColorPicker').value = '#ffffff';
            
            document.getElementById('fontSizeSlider').value = 54;
            state.text.size = 54;
            document.getElementById('fontSizeVal').textContent = '54px';
            
            document.getElementById('textXSlider').value = 50;
            document.getElementById('textYSlider').value = 45;
            state.text.x = 50;
            state.text.y = 45;
            document.getElementById('textXVal').textContent = '50%';
            document.getElementById('textYVal').textContent = '45%';
            
            document.querySelectorAll('[data-align]').forEach(b => b.classList.remove('active'));
            document.querySelector('[data-align="center"]').classList.add('active');
            state.textAlign = 'center';
            
            redraw();
            showNotif('âš¡ Otomatik profesyonel tasarÄ±m uygulandÄ±!');
        }

        // ============ START APPLICATION ============
        // Call initialization function to start the app
        // This will be executed after all parts are loaded
        initApp();

        // ============ DRAG & DROP SUPPORT ============
        const canvas = document.getElementById('canvas');
        const canvasContainer = document.querySelector('.canvas-container');

        ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
            canvasContainer.addEventListener(eventName, preventDefaults, false);
        });

        function preventDefaults(e) {
            e.preventDefault();
            e.stopPropagation();
        }

        ['dragenter', 'dragover'].forEach(eventName => {
            canvasContainer.addEventListener(eventName, highlight, false);
        });

        ['dragleave', 'drop'].forEach(eventName => {
            canvasContainer.addEventListener(eventName, unhighlight, false);
        });

        function highlight(e) {
            canvasContainer.style.backgroundColor = '#f0f4ff';
            canvasContainer.style.borderWidth = '3px';
        }

        function unhighlight(e) {
            canvasContainer.style.backgroundColor = '';
            canvasContainer.style.borderWidth = '';
        }

        canvasContainer.addEventListener('drop', handleDrop, false);

        function handleDrop(e) {
            const dt = e.dataTransfer;
            const files = dt.files;

            if (files.length > 0) {
                const file = files[0];
                if (file.type.startsWith('image/')) {
                    if (state.activeLayer >= 0 && state.layers.length > 0) {
                        loadLayerImage(file);
                    } else {
                        showNotif('âš ï¸ LÃ¼tfen Ã¶nce bir katman seÃ§iniz!');
                    }
                }
            }
        }

        // ============ ENHANCED FEATURES ============
        // Double-click canvas to add new layer
        canvas.addEventListener('dblclick', () => {
            if (state.layers.length < 10) {
                document.getElementById('addLayerBtn').click();
            }
        });

        // Enhanced keyboard shortcuts for text management
        document.addEventListener('keydown', (e) => {
            // Ctrl+Alt+T: Add new text
            if (e.ctrlKey && e.altKey && e.key === 't') {
                e.preventDefault();
                document.getElementById('addTextBtn')?.click();
            }
            // Ctrl+Alt+C: Clone current text
            if (e.ctrlKey && e.altKey && e.key === 'c') {
                e.preventDefault();
                if (state.activeText >= 0 && state.texts[state.activeText]) {
                    if (state.texts.length < 20) {
                        const cloned = JSON.parse(JSON.stringify(state.texts[state.activeText]));
                        cloned.id = Date.now();
                        cloned.x = Math.min(100, cloned.x + 5);
                        cloned.y = Math.min(100, cloned.y + 5);
                        state.texts.push(cloned);
                        state.activeText = state.texts.length - 1;
                        renderTexts();
                        updateTextControls();
                        redraw();
                        showNotif('âœ“ YazÄ± klonlandÄ±!');
                    } else {
                        showNotif('âš ï¸ Maksimum 20 yazÄ±!');
                    }
                }
            }
        });

        // Enhanced layer scale with keyboard
        document.addEventListener('keydown', (e) => {
            if (state.layers.length === 0) return;
            const layer = state.layers[state.activeLayer];
            
            if (e.key === '+' || e.key === '=') {
                e.preventDefault();
                const newScale = Math.min(150, layer.scale + 10);
                layer.scale = newScale;
                redraw();
                showNotif(`ğŸ“ Katman boyutu: ${newScale}%`);
            }
            if (e.key === '-' || e.key === '_') {
                e.preventDefault();
                const newScale = Math.max(10, layer.scale - 10);
                layer.scale = newScale;
                redraw();
                showNotif(`ğŸ“ Katman boyutu: ${newScale}%`);
            }
        });

        // Layer opacity quick adjust with arrow keys
        document.addEventListener('keydown', (e) => {
            if (state.layers.length === 0) return;
            if (!e.ctrlKey) return;
            
            const layer = state.layers[state.activeLayer];
            
            if (e.key === 'ArrowUp') {
                e.preventDefault();
                const newOpacity = Math.min(100, layer.opacity + 5);
                layer.opacity = newOpacity;
                redraw();
                showNotif(`ğŸŒ«ï¸ Katman ÅŸeffaflÄ±ÄŸÄ±: ${newOpacity}%`);

            }
            if (e.key === 'ArrowDown') {
                e.preventDefault();
                const newOpacity = Math.max(0, layer.opacity - 5);
                layer.opacity = newOpacity;
                redraw();
                showNotif(`ğŸŒ«ï¸ Katman ÅŸeffaflÄ±ÄŸÄ±: ${newOpacity}%`);
            }
        });

        // Delete key for current active element
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Delete') {
                if (state.activeLogo >= 0) {
                    document.getElementById('removeLogoBtn').click();
                } else if (state.activeLayer >= 0) {
                    document.getElementById('removeLayerBtn').click();
                }
            }
        });

        // ============ HISTORY & UNDO SUPPORT ============
        const history = [];
        const maxHistory = 20;

        function saveHistory() {
            try {
                const snapshot = {
                    format: state.format,
                    gradient: state.gradient,
                    filter: state.filter,
                    blur: state.blur,
                    overlay: state.overlay,
                    brightness: state.brightness,
                    contrast: state.contrast,
                    saturate: state.saturate,
                    hue: state.hue,
                    bgOpacity: state.bgOpacity,
                    bgScale: state.bgScale,
                    bgRotation: state.bgRotation,
                    activeText: state.activeText,
                    texts: JSON.parse(JSON.stringify(state.texts)),
                    layers: state.layers.map(l => ({
                        scale: l.scale,
                        x: l.x,
                        y: l.y,
                        rot: l.rot,
                        opacity: l.opacity,
                        image: l.image ? 'âœ“' : null
                    })),
                    logos: state.logos.map(l => ({
                        size: l.size,
                        x: l.x,
                        y: l.y,
                        rot: l.rot,
                        opacity: l.opacity,
                        image: l.image ? 'âœ“' : null
                    }))
                };
                history.push(snapshot);
                if (history.length > maxHistory) history.shift();
            } catch(e) {
                // Silent fail
            }
        }

        function undo() {
            if (history.length <= 1) {
                showNotif('âš ï¸ Daha geri gidilemiyor!');
                return;
            }
            history.pop(); // Remove current
            const snapshot = history[history.length - 1];
            
            state.format = snapshot.format;
            state.gradient = snapshot.gradient;
            state.filter = snapshot.filter;
            state.blur = snapshot.blur;
            state.overlay = snapshot.overlay;
            state.brightness = snapshot.brightness;
            state.contrast = snapshot.contrast;
            state.saturate = snapshot.saturate;
            state.hue = snapshot.hue;
            state.bgOpacity = snapshot.bgOpacity;
            state.bgScale = snapshot.bgScale;
            state.bgRotation = snapshot.bgRotation;
            state.activeText = snapshot.activeText;
            state.texts = JSON.parse(JSON.stringify(snapshot.texts));

            // Update UI
            document.getElementById('blurSlider').value = state.blur;
            document.getElementById('blurVal').textContent = state.blur + 'px';
            document.getElementById('overlaySlider').value = state.overlay;
            document.getElementById('overlayVal').textContent = state.overlay + '%';
            document.getElementById('brightnessSlider').value = state.brightness;
            document.getElementById('brightnessVal').textContent = state.brightness + '%';
            document.getElementById('contrastSlider').value = state.contrast;
            document.getElementById('contrastVal').textContent = state.contrast + '%';
            document.getElementById('saturateSlider').value = state.saturate;
            document.getElementById('saturateVal').textContent = state.saturate + '%';
            document.getElementById('hueSlider').value = state.hue;
            document.getElementById('hueVal').textContent = state.hue + 'Â°';
            document.getElementById('bgOpacitySlider').value = state.bgOpacity;
            document.getElementById('bgOpacityVal').textContent = state.bgOpacity + '%';
            document.getElementById('bgScaleSlider').value = state.bgScale;
            document.getElementById('bgScaleVal').textContent = state.bgScale + '%';
            document.getElementById('bgRotSlider').value = state.bgRotation;
            document.getElementById('bgRotVal').textContent = state.bgRotation + 'Â°';

            renderTexts();
            updateTextControls();
            redraw();
            showNotif('â†¶ Geri alÄ±ndÄ±!');
        }

        // Ctrl+Z for undo
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.key === 'z') {
                e.preventDefault();
                undo();
            }
        });

        // Modify redraw to auto-save history
        const originalRedraw = redraw;
        redraw = function() {
            originalRedraw.call(this);
            saveHistory();
        };

        // Initial history save
        saveHistory();
        setInterval(() => {
            try {
                const saveData = {
                    format: state.format,
                    filter: state.filter,
                    blur: state.blur,
                    overlay: state.overlay,
                    brightness: state.brightness,
                    contrast: state.contrast,
                    saturate: state.saturate,
                    hue: state.hue,
                    bgOpacity: state.bgOpacity,
                    bgScale: state.bgScale,
                    bgRotation: state.bgRotation,
                    textAlign: state.textAlign,
                    text: JSON.parse(JSON.stringify(state.text))
                };
                localStorage.setItem('designState', JSON.stringify(saveData));
            } catch(e) {
                // Silent fail for localStorage
            }
        }, 30000);

        // Load saved state if available
        try {
            const saved = localStorage.getItem('designState');
            if (saved) {
                const saveData = JSON.parse(saved);
                Object.assign(state, saveData);
                
                // Update UI with saved values
                document.getElementById('blurSlider').value = state.blur;
                document.getElementById('overlaySlider').value = state.overlay;
                document.getElementById('brightnessSlider').value = state.brightness;
                document.getElementById('contrastSlider').value = state.contrast;
                document.getElementById('saturateSlider').value = state.saturate;
                document.getElementById('hueSlider').value = state.hue;
                document.getElementById('fontSizeSlider').value = state.text.size;
                document.getElementById('textOpacitySlider').value = state.text.opacity;
                document.getElementById('shadowSlider').value = state.text.shadow;
                document.getElementById('textXSlider').value = state.text.x;
                document.getElementById('textYSlider').value = state.text.y;
                document.getElementById('textRotSlider').value = state.text.rot;
                document.getElementById('textColorPicker').value = state.text.color;
                document.getElementById('fontSelect').value = state.text.family;
                document.getElementById('textArea').value = state.text.content;
                document.getElementById('bgOpacitySlider').value = state.bgOpacity;
                document.getElementById('bgScaleSlider').value = state.bgScale;
                document.getElementById('bgRotSlider').value = state.bgRotation;
                
                redraw();
            }
        } catch(e) {
            // Silent fail for localStorage
        }
    </script>
